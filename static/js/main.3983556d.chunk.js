(this["webpackJsonp@papawattu/moneymanager-ui"]=this["webpackJsonp@papawattu/moneymanager-ui"]||[]).push([[0],{283:function(e,t,n){},292:function(e,t){},294:function(e,t){},308:function(e,t){},310:function(e,t){},338:function(e,t){},340:function(e,t){},341:function(e,t){},346:function(e,t){},348:function(e,t){},354:function(e,t){},356:function(e,t){},375:function(e,t){},387:function(e,t){},390:function(e,t){},418:function(e,t,n){},420:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(17),i=n.n(c),s=(n(283),n(284),n(21)),o=n.n(s),u=n(38),l=n(7),d=n(26),j=n(34),b=n(2),m={user:null,token:null,transactions:[],error:null,eventSource:null,fetchTransactions:function(){}},O=function(e){var t=e.apiBaseUri,n=e.children,a=x({apiBaseUri:t}),c=a.login,i=a.googleLogin,s=function(e){return e.apiBaseUri,function(e,t){var n,r;switch(t.type){case"FETCH_TRANSACTIONS":return Object(j.a)(Object(j.a)({},e),{},{transactions:t.payload});case"SET_TOKEN":return Object(j.a)(Object(j.a)({},e),{},{token:t.payload});case"LOGIN":return Object(j.a)(Object(j.a)({},e),{},{user:t.payload.user,eventSource:t.payload.eventSource,error:null===(n=t.payload)||void 0===n?void 0:n.error});case"LOGOUT":return Object(j.a)(Object(j.a)({},e),{},{user:null,eventSource:null});case"ADD_TRANSACTION":return Object(j.a)(Object(j.a)({},e),{},{error:null===(r=t.payload)||void 0===r?void 0:r.error});case"TRANSACTION_POSTED":return Object(j.a)(Object(j.a)({},e),{},{transactions:[].concat(Object(d.a)(e.transactions),[t.payload.transaction])});case"EVENTS_READY":return Object(j.a)(Object(j.a)({},e),{},{eventSource:t.payload.eventSource});default:return e}}}({apiBaseUri:t}),O=function(e){var t=e.apiBaseUri;return function(){var e=Object(u.a)(o.a.mark((function e(n){var r,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.token,e.next=3,fetch("".concat(t,"/transaction/"),{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)},mode:"cors"});case 3:return a=e.sent,e.next=6,a.json();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}({apiBaseUri:t}),h=Object(r.useReducer)(s,m),f=Object(l.a)(h,2),g=f[0],v=f[1],N=function(){var e=Object(u.a)(o.a.mark((function e(t){var n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.token,e.next=3,O({token:n});case 3:r=e.sent,v({type:"FETCH_TRANSACTIONS",payload:r});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),y=function(e){v({type:"LOGIN",payload:{user:e.user}});var t=e.user.token;N({token:t})},S=function(){var e=Object(u.a)(o.a.mark((function e(t,n){var r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c(t,n);case 3:r=e.sent,y(r),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),v({type:"LOGIN",payload:{error:e.t0.message}});case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),T=function(){var e=Object(u.a)(o.a.mark((function e(t){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i({token:t.credential,username:"Jamie"});case 3:n=e.sent,y(n),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),v({type:"LOGIN",payload:{error:e.t0.message}});case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}();return Object(b.jsx)(p.Provider,{value:{transactions:g.transactions,user:g.user,error:g.error,eventSource:g.eventSource,fetchTransactions:N,doLogin:S,doGoogleLogin:T,doLogout:function(){window.google.accounts.id.disableAutoSelect(),v({type:"LOGOUT"})},doAddTransaction:function(e){var n=e.transaction,r=e.token;fetch(t+"/transaction/",{method:"POST",mode:"cors",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)},body:JSON.stringify(n)}).then(function(){var e=Object(u.a)(o.a.mark((function e(t){var n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.ok){e.next=9;break}return e.next=3,t.json();case 3:return n=e.sent,r=n.transaction,v({type:"ADD_TRANSACTION",payload:r}),e.abrupt("return",r);case 9:v({type:"ADD_TRANSACTION",payload:{error:t.statusText}});case 10:return e.abrupt("return");case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){v({type:"ADD_TRANSACTION",payload:{error:e.message}})}))}},children:n})},p=Object(r.createContext)(),h=n(242),f=n.n(h),x=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.apiBaseUri,n=void 0===t?"":t,r=e.auth,a=void 0===r?"/auth":r,c=function(e,t){return fetch(n+a+"/login",{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})}).then(function(){var t=Object(u.a)(o.a.mark((function t(n){var r,a,c;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n.ok){t.next=10;break}return t.next=3,n.json();case 3:return r=t.sent,a=r.token,(c={}).username=e,c.token=a,c.loggedIn=!0,t.abrupt("return",{user:c});case 10:return t.abrupt("return",{error:n.statusText});case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(e){return{error:e.message}}))},i=function(e){var t=e.token;e.username;return fetch("".concat(n).concat(a,"/google?token=").concat(t),{method:"GET",mode:"cors",headers:{"Content-Type":"application/json"}}).then(function(){var e=Object(u.a)(o.a.mark((function e(t){var n,r,a,c,i,s,u,l,d,j;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.ok){e.next=8;break}return e.next=3,t.json();case 3:return n=e.sent,r=n.token,a=f.a.decode(r),c=a.email,i=a.familyName,s=a.givenName,u=a.name,l=a.picture,d=a.username,j={email:c,familyName:i,givenName:s,name:u,picture:l,username:d,token:r,loggedIn:!0},e.abrupt("return",{user:j});case 8:return e.abrupt("return",{error:t.statusText});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){return{error:e.message}}))};return{login:c,googleLogin:i}},g=n(44),v=n(22),N=n(486),y=n(489),S=n(479),T=n(474),A=n(478),C=n(477),k=n(471),w=n(475),_=n(476),E=n(163),D=function(e){var t=e.transactions;return Object(b.jsx)(b.Fragment,{children:t.length?Object(b.jsx)(k.a,{children:Object(b.jsxs)(T.a,{children:[Object(b.jsx)(w.a,{children:Object(b.jsxs)(_.a,{children:[Object(b.jsx)(C.a,{children:"Activity"}),Object(b.jsx)(C.a,{children:"Date"}),Object(b.jsx)(C.a,{children:"Time"}),Object(b.jsx)(C.a,{children:"From"}),Object(b.jsx)(C.a,{children:"To"}),Object(b.jsx)(C.a,{children:"Amount"})]})}),Object(b.jsx)(A.a,{children:t.sort((function(e,t){return Date.parse(t.timestamp)-Date.parse(e.timestamp)})).slice(0,5).map((function(e){return Object(b.jsxs)(_.a,{children:[Object(b.jsx)(C.a,{children:e.description}),Object(b.jsx)(C.a,{children:new Date(e.timestamp).toLocaleDateString()}),Object(b.jsx)(C.a,{children:new Date(e.timestamp).toLocaleTimeString()}),Object(b.jsx)(C.a,{children:e.sender}),Object(b.jsx)(C.a,{children:e.receiver}),Object(b.jsxs)(C.a,{children:["\xa3",e.amount]})]},e.id)}))})]})}):Object(b.jsx)(E.a,{variant:"h3",component:"h3",color:"textSecondary",align:"center",children:"No transactions"})})},I=function(e){var t=e.user,n=e.transactions;return t?function(e){var t=e.user;return e.transactions.filter((function(e){return e.receiver===t}))}({user:t,transactions:n}).reduce((function(e,t){return e+t.amount}),0)-function(e){var t=e.user;return e.transactions.filter((function(e){return e.sender===t}))}({user:t,transactions:n}).reduce((function(e,t){return e+t.amount}),0):0},L=function(e){var t=e.transactions,n=e.user;return Object(b.jsxs)(E.a,{variant:"h4",component:"h4",color:"textSecondary",align:"center",children:[n.givenName," your Balance is"," ",Object(b.jsxs)("span",{className:I({transactions:t,user:n.username})<0?"error":"",children:["\xa3",Math.abs(I({transactions:t,user:n.username}).toFixed(2))," ",I({transactions:t,user:n.username})<0?"DR":""]})]})},R=n(168),P=n(81),U=n(249),B=n.n(U),F=n(490),G=n(485),H=n(481),J=n(482),M=n(480),K=n(59),V=function(){var e=Object(r.useState)(!1),t=Object(l.a)(e,2),n=t[0],a=t[1],c=Object(r.useContext)(p),i=c.user,s=i.token,o=i.username,u=c.doAddTransaction,d=c.error,j=Object(K.e)({initialValues:{description:"",amount:0,receiver:"",sender:o,deposit:!0,transfer:!1,type:"deposit"},onSubmit:function(e,t){!function(e){var t={sender:o,receiver:e.receiver,amount:e.amount,description:e.description};console.log(JSON.stringify(t)),u({transaction:t,token:s})}(e),t.setSubmitting(!1),m()}}),m=function(){return a(!1)};return Object(b.jsxs)(y.a,{justifyContent:"center",display:"flex",children:[Object(b.jsx)("br",{}),Object(b.jsxs)(S.a,{color:"primary","aria-label":"add",variant:"extended",onClick:function(){return a(!0)},children:[Object(b.jsx)(B.a,{}),"Add Transaction"]}),Object(b.jsxs)(F.a,{open:n,onClose:m,"aria-labelledby":"form-dialog-title",children:[Object(b.jsx)(M.a,{id:"form-dialog-title",children:"Transfer money"}),Object(b.jsxs)(H.a,{children:[Object(b.jsx)(J.a,{children:"Transfer money to another person."}),Object(b.jsxs)("form",{onSubmit:j.handleSubmit,children:[Object(b.jsx)(R.a,{name:"receiver",type:"text",label:"Receiver",value:j.values.receiver,onChange:j.handleChange}),Object(b.jsx)("br",{}),Object(b.jsx)(R.a,{name:"amount",type:"number",label:"Amount",value:j.values.amount,onChange:j.handleChange}),Object(b.jsx)("br",{}),Object(b.jsx)(R.a,{name:"description",label:"Description (optional)",value:j.values.description,onChange:j.handleChange}),Object(b.jsx)("br",{}),Object(b.jsxs)(G.a,{children:[Object(b.jsx)(P.a,{onClick:m,color:"primary",children:"Cancel"}),Object(b.jsx)(P.a,{variant:"contained",type:"submit",color:"primary",children:"Send"})]}),Object(b.jsx)("p",{className:"error",children:d})]})]})]})]})},W=n(487),q=function(e){var t=e.apiBaseUri,n=Object(r.useContext)(p),a=n.transactions,c=n.user,i=n.doAddTransaction,s=n.fetchTransactions,o=[];if(c){o=function(e){var t=e.uri,n=e.eventName,a=Object(r.useState)([]),c=Object(l.a)(a,2),i=c[0],s=c[1],o=function(e){var t=e.data,n=JSON.parse(t);s([].concat(Object(d.a)(i),[n])),console.log(JSON.stringify(i))};return Object(r.useEffect)((function(){var e=new EventSource(t,{withCredentials:!1});return e.addEventListener(n,o),function(){return e.close()}}),[i]),i}({uri:"".concat(t,"/events/?token=").concat(c.token),eventName:"transactionPosted"}).concat(a)}return c?Object(b.jsx)(N.a,{children:Object(b.jsxs)(y.a,{display:"grid",margin:"auto",children:[Object(b.jsx)(L,{transactions:o,user:c}),Object(b.jsx)(D,{transactions:o}),Object(b.jsx)(S.a,{color:"primary","aria-label":"refresh",size:"small",onClick:function(){return s({token:c.token})},children:Object(b.jsx)(W.a,{})}),Object(b.jsx)(V,{addTransaction:i})]})}):Object(b.jsx)(v.a,{to:"/login"})},z=function(){return Object(b.jsx)(K.d,{initialValues:{name:"",email:""},validate:function(e){var t={};return e.email?/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i.test(e.email)||(t.email="Invalid email address"):t.email="Email address is required",e.name||(t.name="Name is required"),t},onSubmit:function(e,t){var n=t.setSubmitting;setTimeout((function(){alert(JSON.stringify(e,null,2)),n(!1)}),400)},children:function(e){var t=e.isSubmitting;return Object(b.jsxs)(K.c,{children:[Object(b.jsxs)("div",{className:"form-control",children:[Object(b.jsx)(K.b,{type:"text",name:"name",placeholder:"Your name"}),Object(b.jsx)(K.a,{name:"name",component:"div",className:"form-error"})]}),Object(b.jsxs)("div",{className:"form-control",children:[Object(b.jsx)(K.b,{type:"email",name:"email",placeholder:"Email address"}),Object(b.jsx)(K.a,{name:"email",component:"div",className:"form-error"})]}),Object(b.jsx)("div",{className:"form-control",children:Object(b.jsx)("button",{className:"btn btn-primary",type:"submit",disabled:t,children:"Submit"})})]})}})},Z=function(e){var t=e.signup;e.googleClientId;return Object(b.jsx)("section",{className:"showcase",children:Object(b.jsxs)("div",{className:"container grid",children:[Object(b.jsxs)("div",{className:"showcase-text",children:[Object(b.jsx)("h2",{children:"Heading"}),Object(b.jsx)("p",{children:"Manage your money Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed eget nibh ipsum. Praesent in maximus neque. Donec justo augue, gravida sit amet elementum non, vestibulum ac nulla. Aliquam suscipit ipsum eget elit cursus, in laoreet nunc porta. Maecenas dignissim diam sapien, sed fringilla eros imperdiet sed. Nullam iaculis imperdiet diam, eget tempor tortor tincidunt quis. Duis blandit erat id finibus interdum."}),Object(b.jsx)("a",{href:"#features",className:"btn btn-outline",children:"Read more"})]}),Object(b.jsxs)("div",{className:"showcase-form card",children:[Object(b.jsx)("h3",{children:"Sign up"}),Object(b.jsx)(z,{signup:t})]})]})})},Y=n(159),$=n(160),Q=n(493),X=function(){var e=Object(r.useContext)(p).user;return Object(b.jsx)("div",{className:"navbar",children:Object(b.jsxs)("div",{className:"container flex",children:[Object(b.jsx)("h1",{className:"logo",children:Object(b.jsxs)(g.b,{to:(null===e||void 0===e?void 0:e.loggedIn)?"/dashboard":"/",children:[Object(b.jsx)(Y.a,{icon:$.a}),Object(b.jsx)("span",{children:"Money Manager"})]})}),Object(b.jsx)("nav",{children:Object(b.jsxs)("ul",{children:[(null===e||void 0===e?void 0:e.loggedIn)?Object(b.jsxs)(b.Fragment,{children:[Object(b.jsxs)("li",{children:[" ",e?Object(b.jsx)(b.Fragment,{children:Object(b.jsx)(Q.a,{alt:e.name,src:e.picture})}):null]}),Object(b.jsx)("li",{children:Object(b.jsx)(g.b,{to:"/logout",children:"Log out"})})]}):Object(b.jsxs)("li",{children:[Object(b.jsx)(Y.a,{icon:$.b}),Object(b.jsx)(g.b,{to:"/login",children:"Login"})]}),Object(b.jsx)("li",{children:Object(b.jsx)(g.b,{to:"/about",children:"About"})})]})})]})})},ee=n(250),te=[{field:"id",headerName:"ID",width:90},{field:"firstName",headerName:"First name",width:150},{field:"lastName",headerName:"Last name",width:150,editable:!0},{field:"age",headerName:"Age",type:"currency",width:110,editable:!0},{field:"fullName",headerName:"Full name",description:"This column has a value getter and is not sortable.",sortable:!1,width:160,valueGetter:function(e){return"".concat(e.getValue(e.id,"firstName")||""," ").concat(e.getValue(e.id,"lastName")||"")}}],ne=[{id:1,lastName:"Snow",firstName:"Jon",age:35},{id:2,lastName:"Lannister",firstName:"Cersei",age:42},{id:3,lastName:"Lannister",firstName:"Jaime",age:45},{id:4,lastName:"Stark",firstName:"Arya",age:16},{id:5,lastName:"Targaryen",firstName:"Daenerys",age:null},{id:6,lastName:"Melisandre",firstName:null,age:150},{id:7,lastName:"Clifford",firstName:"Ferrara",age:44},{id:8,lastName:"Frances",firstName:"Rossini",age:36},{id:9,lastName:"Roxie",firstName:"Harvey",age:65}],re=function(){return Object(b.jsx)(N.a,{maxWidth:"lg",style:{height:400},children:Object(b.jsx)(ee.a,{rows:ne,columns:te,pageSize:5})})},ae=function(){return Object(b.jsx)("footer",{className:"footer",children:Object(b.jsx)("div",{children:"Copyright \xa9 2021"})})},ce=(n(252),n(415),function(){return(0,Object(r.useContext)(p).doLogout)(),Object(b.jsx)(v.a,{to:"/"})}),ie=(n(418),n(488)),se=n(253),oe=n.n(se),ue=function(e){var t=e.children;return Object(b.jsx)("div",{children:t})},le=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(e.clientId,Object(r.useRef)(null)),n=Object(r.useState)(!0),a=Object(l.a)(n,2),c=a[0],i=a[1],s=Object(r.useContext)(p),o=s.user,u=s.doGoogleLogin,d=(s.error,oe()({src:"https://accounts.google.com/gsi/client"})),j=Object(l.a)(d,1),m=j[0],O=function(e){u(e)};return Object(r.useEffect)((function(){if(!m&&(window.google.accounts.id.initialize({client_id:"557258334399-4vpeqbtm8iiu0f448sgl7pet75fo54u0.apps.googleusercontent.com",callback:O,context:["signin","use"],auto_select:!0,ux_mode:"popup"}),c))try{window.google.accounts.id.prompt((function(e){console.log(e.getNotDisplayedReason()),(e.isNotDisplayed()||e.isSkippedMoment())&&(console.log("Render"),i(e.isDisplayed()),window.google.accounts.id.renderButton(t.current,{theme:"outline",size:"large"}))}))}catch(e){console.log("ryr"),console.error(e)}}),[m,c]),Object(b.jsx)("div",{children:(null===o||void 0===o?void 0:o.loggedIn)?Object(b.jsx)(v.a,{to:"/dashboard"}):c?Object(b.jsx)("p",{children:"Loading..."}):Object(b.jsx)(ue,{children:Object(b.jsx)("div",{ref:t})})})},de=function(e){var t=e.apiBaseUri,n=void 0===t?"https://wattu.ddns.net":t,a=e.googleClientId,c=void 0===a?Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_APIBASEURI:"https://wattu.ddns.net"}).REACT_APP_GOOGLE_CLIENT_ID:a,i=Object(r.useState)({loggedIn:!1}),s=x({apiBaseUri:n,userState:i,auth:Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_APIBASEURI:"https://wattu.ddns.net"}).REACT_APP_AUTHURI}),o=(s.login,s.signup);s.getUserProfile,s.isLoggedIn,s.getToken,s.fetchUserData;return Object(b.jsxs)(O,{apiBaseUri:n,children:[Object(b.jsx)(ie.a,{}),Object(b.jsxs)(g.a,{children:[Object(b.jsx)(X,{}),Object(b.jsxs)(v.d,{children:[Object(b.jsx)(v.b,{exact:!0,path:"/",children:Object(b.jsx)(Z,{signup:o,clientId:c})}),Object(b.jsx)(v.b,{path:"/about",children:Object(b.jsx)(re,{})}),Object(b.jsx)(v.b,{path:"/logout",children:Object(b.jsx)(ce,{})}),Object(b.jsx)(v.b,{path:"/dashboard",children:Object(b.jsx)(q,{apiBaseUri:n})}),Object(b.jsx)(v.b,{path:"/login",children:Object(b.jsx)(le,{clientId:c})})]})]}),Object(b.jsx)(ae,{})]})},je=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,495)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),r(e),a(e),c(e),i(e)}))};i.a.render(Object(b.jsx)(a.a.StrictMode,{children:Object(b.jsx)(de,{})}),document.getElementById("root")),je(console.log)}},[[420,1,2]]]);
//# sourceMappingURL=main.3983556d.chunk.js.map